$.fn.extend({autoComplete:function(e){function t(e){return e instanceof Element||e instanceof HTMLDocument}const n={};let a=new Object;"object"==typeof e&&(n.source=e.source||[],n.render=e.render||function(e,n,a,s,c){if(!e.length&&!n.length)return void s.empty().css("display","none");s.empty().css("display","block");let o=`menu-item${c.menuItemClass.length?" "+c.menuItemClass:""}`;!n.length&&e.length&&(o+=" not-found","string"==typeof c.empty?s.append(`<div class="${o}">${c.empty}</div>`):t(c.empty)&&s.append(c.empty));for(let e=0;e<n.length;e++){const a=n[e];if("string"==typeof a)s.append(`<div class="${o}"><a href="javascript:void(0)">${a}</a></div>`);else if("object"==typeof a){const e=$(`<div class="${o}"><a href="javascript:void(0)">${a.text}</a></div>`);"object"==typeof a.attribute&&e.attr(a.attribute),"object"==typeof a.data&&e.data(a.data),s.append(e)}else t(a)&&s.append(a)}},n.error=e.error||console.error,n.delay=e.delay||0,n.minChar=e.minChar||0,n.menuClass=e.menuClass||"",n.menuItemClass=e.menuItemClass||"",n.empty=e.empty||"Not Found",n.cache=e.cache||!1,n.clearCacheInterval=e.clearCacheInterval||6e5,n.runOnFocus=e.runOnFocus||!0),n.cache&&n.clearCacheInterval&&setInterval(function(){a=new Object},n.clearCacheInterval);const s=$(this),c=this.find(".form-input");let o=c.siblings(".menu");o.length||(o=$(`<div class="menu${n.menuClass.length?" "+n.menuClass:""}"></div>`),c.after(o)),s.addClass("spectre-auto-complete-container");const i=function(e,t,n){let a;return function(){let s=this,c=arguments;clearTimeout(a),a=setTimeout(function(){a=null,n||e.apply(s,c)},t),n&&!a&&e.apply(s,c)}}(function(e){const t=e.data.$inpt;if(27===e.which)e.data.$menu.css("display","none"),t.blur();else if(38===e.which||40===e.which){const t=e.data.$menu,n=t.find(".menu-item"),a=n.filter(".hover");let s;if(a.length){const t=a.index();let c;c=38===e.which?0===t?n.length-1:t-1:t===n.length-1?0:t+1,a.removeClass("hover"),s=n.eq(c).addClass("hover")}else if(40===e.which)return void(s=n.eq(0).addClass("hover"));t.scrollTop(s.offset().top-t.offset().top+t.scrollTop()-t.height()/2)}else if(13===e.which){const e=o.find(".hover");e.length&&e.trigger("click")}else{const n=e.data.$container;let a=t.val();const s=e.data.opts;if(a.length>=s.minChar){const c=s.source,i=s.render,l=s.error;if("function"==typeof c){if(s.cache){const n=e.data.caches;if(n[a])return void i(a,n[a],t,o,s)}c(a,(n,c)=>{n?(s.cache&&(e.data.caches[a]=n),i(a,n,t,o,s)):l(c)},n,t,s)}else if(Array.isArray(c)){let n=[];if(a.length){if(s.cache){const n=e.data.caches;if(n[a])return void i(a,n[a],t,o,s)}const l=new RegExp(a,"g");for(let e=0;e<c.length;e++){const t=c[e];"string"==typeof t&&l.test(t)&&n.push(t.replace(l,"<mark>$&</mark>"))}s.cache&&(e.data.caches[a]=n)}i(a,n,t,o,s)}}}},n.delay);c.on(`keydown${e.runOnFocus?" focus":""}`,{$container:s,$inpt:c,$menu:o,caches:a,opts:n},i),s.on("click",".menu-item, .menu-item a",{$inpt:c},function(e){const t=e.data.$inpt,n=$(this);let a;a=n.is("a")?n.parent(".menu-item"):n;const s=t.siblings(".menu");a.removeClass("hover");const c=a.data("value")||a.find("a").text();s.css("display","none"),t.val(c).data(a.data())}),$(document).on("click",{$menu:o,$inpt:c},function(e){const t=e.data.$menu;$.contains(t.get(0),e.target)||c.get(0)===e.target||t.css("display","none")})}});