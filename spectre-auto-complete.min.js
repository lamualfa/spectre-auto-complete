$.fn.extend({autoComplete:function(e){function t(e){return e instanceof Element||e instanceof HTMLDocument}const n={};let a=new Object;"object"==typeof e&&(n.source=e.source||[],n.render=e.render||function(e,n,a,s){a.empty().css("display","block");const c=`menu-item${s.menuItemClass.length?" "+s.menuItemClass:""}`;e.length||("string"==typeof s.empty?a.append(`<div class="${c}">${v}</div>`):t(s.empty)&&a.append(s.empty));for(let n=0;n<e.length;n++){const s=e[n];if("string"==typeof s)a.append(`<div class="${c}"><a href="javascript:void(0)">${s}</a></div>`);else if("object"==typeof s){const e=$(`<div class="${c}"><a href="javascript:void(0)">${s.value}</a></div>`);"object"==typeof s.attribute&&e.attr(s.attribute),"object"==typeof s.data&&e.data(s.data)}else t(s)&&a.append(s)}},n.error=e.error||console.error,n.delay=e.delay||0,n.minChar=e.minChar||0,n.menuClass=e.menuClass||"",n.menuItemClass=e.menuItemClass||"",n.empty=e.empty||"Not Found",n.cache=e.cache||!1,n.clearCacheInterval=e.clearCacheInterval||6e5),n.cache&&n.clearCacheInterval&&setInterval(function(){a=new Object},n.clearCacheInterval);const s=$(this),c=this.find(".form-input");let o=c.siblings(".menu");o.length||(o=$(`<div class="menu${n.menuClass.length?" "+n.menuClass:""}"></div>`),c.after(o)),s.addClass("spectre-auto-complete-container");const i=function(e,t,n){let a;return function(){let s=this,c=arguments;clearTimeout(a),a=setTimeout(function(){a=null,n||e.apply(s,c)},t),n&&!a&&e.apply(s,c)}}(function(e){const t=e.data.$inpt;if(27===e.which)e.data.$menu.css("display","none");else if(38===e.which||40===e.which){const t=e.data.$menu,n=t.find(".menu-item"),a=n.filter(".hover");let s;if(a.length){const t=a.index();let c;c=38===e.which?0===t?n.length-1:t-1:t===n.length-1?0:t+1,a.removeClass("hover"),s=n.eq(c).addClass("hover")}else if(40===e.which)return void(s=n.eq(0).addClass("hover"));t.scrollTop(s.offset().top-t.offset().top+t.scrollTop()-t.height()/2)}else if(13===e.which){const e=o.find(".hover");e.length&&e.trigger("click")}else{const n=e.data.$container;let a=t.val();const s=e.data.opts;if(a.length>=s.minChar){const c=s.source,i=s.render,l=s.error;if("function"==typeof c){if(s.cache){const n=e.data.caches;if(n[a])return void i(n[a],t,o,s)}c(a,(n,c)=>{n?(s.cache&&(e.data.caches[a]=n),i(n,t,o,s)):l(c)},n,t,s)}else Array.isArray(c)&&i(c,t,o,s)}}},n.delay);c.on("focus keydown",{$container:s,$inpt:c,$menu:o,caches:a,opts:n},i),s.on("click",".menu-item, .menu-item a",{$inpt:c},function(e){const t=e.data.$inpt,n=$(this),a=t.siblings(".menu");n.removeClass("hover");const s=n.data("value")||n.find("a").text();a.css("display","none"),t.val(s)}),$(document).on("click",{$menu:o,$inpt:c},function(e){const t=e.data.$menu;$.contains(t.get(0),e.target)||c.get(0)===e.target||t.css("display","none")})}});